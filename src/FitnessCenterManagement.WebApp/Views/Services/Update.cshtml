@using FitnessCenterManagement.WebApp.Views.Shared.Resources
@using FitnessCenterManagement.WebApp.Views.Services.Resources
@model FitnessCenterManagement.WebApp.Models.ServiceEditingModel
@{
    ViewData["Title"] = ServicesRes.UpdateItem;
}

<h2>@ViewData["Title"]</h2>
<hr />
<form asp-controller="Services" asp-action="edit" asp-antiforgery="true" method="post">
    <div class="validation" asp-validation-summary="ModelOnly"></div>
    <input asp-for="Id" hidden="hidden" />
    <span id="specIdInput" style="display:none" hidden="hidden">@Model.SpecializationId</span>

    <div class="form-group row">
        <label asp-for="Name" class="col-md-2 control-label"></label>
        <div class="col-sm-10">
            <input asp-for="Name" class="form-control" , placeholder="@ServicesRes.NameLabel" />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="Price" class="col-md-2 control-label"></label>
        <div class="col-sm-10">
            <input asp-for="Price" class="form-control" , placeholder="@ServicesRes.PriceLabel" />
            <span asp-validation-for="Price" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="Description" class="col-md-2 control-label"></label>
        <div class="col-sm-10">
            <input asp-for="Description" class="form-control" , placeholder="@ServicesRes.DescriptionLabel" />
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="SpecializationId" class="col-md-2 control-label"></label>
        <div class="col-sm-10">
            <select asp-for="SpecializationId" class="form-control">
                <option value="" id="dropDownChooseValue" disabled="disabled" selected="selected">@ServicesRes.SelectSpecialization</option>
            </select>
        </div>
    </div>

    <div class="form-group row">
        <div class="col-sm-10">
            <input type="submit" class="btn btn-primary btn-icon" value="@SharedStringRes.UpdateBtn" />
        </div>
    </div>
</form>


@await Html.PartialAsync("_ReturnGrayButton", ("Index", "Services", SharedStringRes.GoBackBtn))

@section Scripts{
    <script>
        $(document).ready(loadDropdown());

        let specIdInput = document.getElementById("specIdInput").innerText;

        function loadDropdown() {
            var dropdownElement = document.getElementsByTagName("select")[0].children[0];
            $.ajax({
                type: 'GET',
                url: '/Specializations/find',
                error: function (error) {
                    console.log('Error with receiving data: ' + error)
                },
                success: function (result) {
                    let s = '';
                    if (result.length > 0) {
                        for (let el of result) {
                            if (el.id == specIdInput) {
                                s += '<option selected="selected" value="' + el.id + '">' + el.info + '</option>';
                            }
                            else
                            {
                                s += '<option value="' + el.id + '">' + el.info + '</option>';
                            }
                        }
                    }
                    $(dropdownElement).after(s);
                }
            });
        };
    </script>
}